// Codex Criminalis - Fixed JavaScript (No Syntax Errors)
console.log("ğŸš€ Codex Criminalis Loading...");

// Sample Data - Basic functionality test
const sampleData = {
    "PK": {
        "299": {
            "title": "Î‘Ï€Î¬Ï„Î·",
            "text": "ÎŒÏ€Î¿Î¹Î¿Ï‚ Î¼Îµ ÏƒÎºÎ¿Ï€ÏŒ Î½Î± Î±Ï€Î¿ÎºÎ¿Î¼Î¯ÏƒÎµÎ¹ Î³Î¹Î± Ï„Î¿Î½ ÎµÎ±Ï…Ï„ÏŒ Ï„Î¿Ï… Î® Î³Î¹Î± Î¬Î»Î»Î¿Î½ Ï€Î±ÏÎ¬Î½Î¿Î¼Î¿ Ï€ÎµÏÎ¹Î¿Ï…ÏƒÎ¹Î±ÎºÏŒ ÏŒÏ†ÎµÎ»Î¿Ï‚, Î²Î»Î¬Ï€Ï„ÎµÎ¹ Î¾Î­Î½Î· Ï€ÎµÏÎ¹Î¿Ï…ÏƒÎ¯Î± Ï€ÏÎ¿ÎºÎ±Î»ÏÎ½Ï„Î±Ï‚ Î® Î´Î¹Î±Ï„Î·ÏÏÎ½Ï„Î±Ï‚ ÏƒÎµ ÎºÎ¬Ï€Î¿Î¹Î¿Î½ Ï€Î»Î¬Î½Î· Î¼Îµ Ï„ÎµÏ‡Î½Î¬ÏƒÎ¼Î±Ï„Î± Î® Î¼Îµ Ï€Î±ÏÎ±ÏƒÎ¹ÏÏ€Î·ÏƒÎ· Ï„Î·Ï‚ Î±Î»Î®Î¸ÎµÎ¹Î±Ï‚, Ï„Î¹Î¼Ï‰ÏÎµÎ¯Ï„Î±Î¹ Î¼Îµ Ï†Ï…Î»Î¬ÎºÎ¹ÏƒÎ· Î¼Î­Ï‡ÏÎ¹ Î´Î­ÎºÎ± Î­Ï„Î·.",
            "paragraphs": [
                "ÎŒÏ€Î¿Î¹Î¿Ï‚ Î¼Îµ ÏƒÎºÎ¿Ï€ÏŒ Î½Î± Î±Ï€Î¿ÎºÎ¿Î¼Î¯ÏƒÎµÎ¹ Î³Î¹Î± Ï„Î¿Î½ ÎµÎ±Ï…Ï„ÏŒ Ï„Î¿Ï… Î® Î³Î¹Î± Î¬Î»Î»Î¿Î½ Ï€Î±ÏÎ¬Î½Î¿Î¼Î¿ Ï€ÎµÏÎ¹Î¿Ï…ÏƒÎ¹Î±ÎºÏŒ ÏŒÏ†ÎµÎ»Î¿Ï‚, Î²Î»Î¬Ï€Ï„ÎµÎ¹ Î¾Î­Î½Î· Ï€ÎµÏÎ¹Î¿Ï…ÏƒÎ¯Î± Ï€ÏÎ¿ÎºÎ±Î»ÏÎ½Ï„Î±Ï‚ Î® Î´Î¹Î±Ï„Î·ÏÏÎ½Ï„Î±Ï‚ ÏƒÎµ ÎºÎ¬Ï€Î¿Î¹Î¿Î½ Ï€Î»Î¬Î½Î· Î¼Îµ Ï„ÎµÏ‡Î½Î¬ÏƒÎ¼Î±Ï„Î± Î® Î¼Îµ Ï€Î±ÏÎ±ÏƒÎ¹ÏÏ€Î·ÏƒÎ· Ï„Î·Ï‚ Î±Î»Î®Î¸ÎµÎ¹Î±Ï‚, Ï„Î¹Î¼Ï‰ÏÎµÎ¯Ï„Î±Î¹ Î¼Îµ Ï†Ï…Î»Î¬ÎºÎ¹ÏƒÎ· Î¼Î­Ï‡ÏÎ¹ Î´Î­ÎºÎ± Î­Ï„Î·."
            ]
        },
        "280": {
            "title": "ÎšÎ»Î¿Ï€Î®",
            "text": "ÎŒÏ€Î¿Î¹Î¿Ï‚ Î±Ï†Î±Î¹ÏÎµÎ¯ Î¾Î­Î½Î¿ ÎºÎ¹Î½Î·Ï„ÏŒ Ï€ÏÎ¬Î³Î¼Î± Î¼Îµ ÏƒÎºÎ¿Ï€ÏŒ Î½Î± Ï„Î¿ Î¹Î´Î¹Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Ï€Î±ÏÎ¬Î½Î¿Î¼Î±, Ï„Î¹Î¼Ï‰ÏÎµÎ¯Ï„Î±Î¹ Î¼Îµ Ï†Ï…Î»Î¬ÎºÎ¹ÏƒÎ· Î¼Î­Ï‡ÏÎ¹ Ï€Î­Î½Ï„Îµ Î­Ï„Î· Î® Î¼Îµ Ï‡ÏÎ·Î¼Î±Ï„Î¹ÎºÎ® Ï€Î¿Î¹Î½Î®.",
            "paragraphs": [
                "ÎŒÏ€Î¿Î¹Î¿Ï‚ Î±Ï†Î±Î¹ÏÎµÎ¯ Î¾Î­Î½Î¿ ÎºÎ¹Î½Î·Ï„ÏŒ Ï€ÏÎ¬Î³Î¼Î± Î¼Îµ ÏƒÎºÎ¿Ï€ÏŒ Î½Î± Ï„Î¿ Î¹Î´Î¹Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Ï€Î±ÏÎ¬Î½Î¿Î¼Î±, Ï„Î¹Î¼Ï‰ÏÎµÎ¯Ï„Î±Î¹ Î¼Îµ Ï†Ï…Î»Î¬ÎºÎ¹ÏƒÎ· Î¼Î­Ï‡ÏÎ¹ Ï€Î­Î½Ï„Îµ Î­Ï„Î· Î® Î¼Îµ Ï‡ÏÎ·Î¼Î±Ï„Î¹ÎºÎ® Ï€Î¿Î¹Î½Î®.",
                "Î•Î¬Î½ Î· Î±Î¾Î¯Î± Ï„Î¿Ï… Ï€ÏÎ¬Î³Î¼Î±Ï„Î¿Ï‚ Î´ÎµÎ½ Ï…Ï€ÎµÏÎ²Î±Î¯Î½ÎµÎ¹ Ï„Î± Ï„ÎµÏ„ÏÎ±ÎºÏŒÏƒÎ¹Î± ÎµÏ…ÏÏ, Î¿ Î´ÏÎ¬ÏƒÏ„Î·Ï‚ Ï„Î¹Î¼Ï‰ÏÎµÎ¯Ï„Î±Î¹ Î¼Îµ Ï†Ï…Î»Î¬ÎºÎ¹ÏƒÎ· Î¼Î­Ï‡ÏÎ¹ Î´ÏÎ¿ Î­Ï„Î· Î® Î¼Îµ Ï‡ÏÎ·Î¼Î±Ï„Î¹ÎºÎ® Ï€Î¿Î¹Î½Î®.",
                "Î•Î¬Î½ Î· ÎºÎ»Î¿Ï€Î® Î´Î¹Î±Ï€ÏÎ¬Ï‡Î¸Î·ÎºÎµ ÎºÎ±Ï„Î¬ ÏƒÏ…Î½Î±Ï…Ï„Î¿Ï…ÏÎ³Î¯Î± Î±Ï€ÏŒ Ï„ÏÎ¯Î± Î® Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± Ï€ÏÏŒÏƒÏ‰Ï€Î±, Î· Ï€Î¿Î¹Î½Î® ÎµÎ¯Î½Î±Î¹ Ï†Ï…Î»Î¬ÎºÎ¹ÏƒÎ· Î±Ï€ÏŒ Î­Î¾Î¹ Î¼Î®Î½ÎµÏ‚ Î¼Î­Ï‡ÏÎ¹ Î´Î­ÎºÎ± Î­Ï„Î·."
            ]
        }
    },
    "KPD": {
        "322": {
            "title": "Î ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î® ÎºÏÎ¬Ï„Î·ÏƒÎ·",
            "text": "ÎœÎµ Î²Î¿ÏÎ»ÎµÏ…Î¼Î± Î® Î´Î¹Î¬Ï„Î±Î³Î¼Î± Ï„Î¿Ï… Î´Î¹ÎºÎ±ÏƒÏ„Î¹ÎºÎ¿Ï ÏƒÏ…Î¼Î²Î¿Ï…Î»Î¯Î¿Ï… Î® Ï„Î¿Ï… Î´Î¹ÎºÎ±ÏƒÏ„Î® Î±Î½Î±ÎºÏÎ¯ÏƒÎµÏ‰Ï‚, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î´Î¹Î±Ï„Î±Ï‡Î¸ÎµÎ¯ Î· Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î® ÎºÏÎ¬Ï„Î·ÏƒÎ· Ï„Î¿Ï… ÎºÎ±Ï„Î·Î³Î¿ÏÎ¿ÏÎ¼ÎµÎ½Î¿Ï… ÎµÎ¬Î½ ÏƒÏ…Î½Ï„ÏÎ­Ï‡Î¿Ï…Î½ Î¿Î¹ Ï€ÏÎ¿Ï‹Ï€Î¿Î¸Î­ÏƒÎµÎ¹Ï‚ Ï„Ï‰Î½ Î¬ÏÎ¸ÏÏ‰Î½ 282 ÎºÎ±Î¹ 307 ÎºÎ±Î¹ ÎµÎ¬Î½ ÎµÎ¯Î½Î±Î¹ Î±Î½Î±Î³ÎºÎ±Î¯Î± Î³Î¹Î± Î½Î± ÎµÎ¾Î±ÏƒÏ†Î±Î»Î¹ÏƒÎ¸ÎµÎ¯ Î· Ï€Î±ÏÎ¿Ï…ÏƒÎ¯Î± Ï„Î¿Ï… ÎºÎ±Ï„Î·Î³Î¿ÏÎ¿ÏÎ¼ÎµÎ½Î¿Ï… ÏƒÏ„Î· Î´Î¯ÎºÎ·.",
            "paragraphs": [
                "ÎœÎµ Î²Î¿ÏÎ»ÎµÏ…Î¼Î± Î® Î´Î¹Î¬Ï„Î±Î³Î¼Î± Ï„Î¿Ï… Î´Î¹ÎºÎ±ÏƒÏ„Î¹ÎºÎ¿Ï ÏƒÏ…Î¼Î²Î¿Ï…Î»Î¯Î¿Ï… Î® Ï„Î¿Ï… Î´Î¹ÎºÎ±ÏƒÏ„Î® Î±Î½Î±ÎºÏÎ¯ÏƒÎµÏ‰Ï‚, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î´Î¹Î±Ï„Î±Ï‡Î¸ÎµÎ¯ Î· Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î® ÎºÏÎ¬Ï„Î·ÏƒÎ· Ï„Î¿Ï… ÎºÎ±Ï„Î·Î³Î¿ÏÎ¿ÏÎ¼ÎµÎ½Î¿Ï… ÎµÎ¬Î½ ÏƒÏ…Î½Ï„ÏÎ­Ï‡Î¿Ï…Î½ Î¿Î¹ Ï€ÏÎ¿Ï‹Ï€Î¿Î¸Î­ÏƒÎµÎ¹Ï‚ Ï„Ï‰Î½ Î¬ÏÎ¸ÏÏ‰Î½ 282 ÎºÎ±Î¹ 307 ÎºÎ±Î¹ ÎµÎ¬Î½ ÎµÎ¯Î½Î±Î¹ Î±Î½Î±Î³ÎºÎ±Î¯Î± Î³Î¹Î± Î½Î± ÎµÎ¾Î±ÏƒÏ†Î±Î»Î¹ÏƒÎ¸ÎµÎ¯ Î· Ï€Î±ÏÎ¿Ï…ÏƒÎ¯Î± Ï„Î¿Ï… ÎºÎ±Ï„Î·Î³Î¿ÏÎ¿ÏÎ¼ÎµÎ½Î¿Ï… ÏƒÏ„Î· Î´Î¯ÎºÎ·.",
                "Î— Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î® ÎºÏÎ¬Ï„Î·ÏƒÎ· Î¼Ï€Î¿ÏÎµÎ¯ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± Î´Î¹Î±Ï„Î±Ï‡Î¸ÎµÎ¯ Î³Î¹Î± Ï„Î·Î½ Î±Ï€Î¿Ï„ÏÎ¿Ï€Î® Î½Î­Ï‰Î½ ÎµÎ³ÎºÎ»Î·Î¼Î¬Ï„Ï‰Î½ Î® Î³Î¹Î± Ï„Î·Î½ ÎµÎ¾Î±ÏƒÏ†Î¬Î»Î¹ÏƒÎ· Ï„Î·Ï‚ Î¿Î¼Î±Î»Î®Ï‚ Î´Î¹ÎµÎ¾Î±Î³Ï‰Î³Î®Ï‚ Ï„Î·Ï‚ Î±Î½Î¬ÎºÏÎ¹ÏƒÎ·Ï‚."
            ]
        }
    }
};

// Basic Search Class
class CodexSearch {
    constructor() {
        this.currentMode = 'quick';
        this.searchIndex = this.buildSearchIndex();
        this.bookmarks = new Set(['299', '322']); // Sample bookmarks
        console.log("ğŸ” Search system initialized");
    }

    buildSearchIndex() {
        console.log("ğŸ“– Building search index...");
        const index = {};
        
        Object.keys(sampleData).forEach(codeType => {
            Object.keys(sampleData[codeType]).forEach(articleNum => {
                const article = sampleData[codeType][articleNum];
                const key = `${articleNum}_${codeType}`;
                
                index[key] = {
                    article: articleNum,
                    code: codeType,
                    title: article.title,
                    text: article.text,
                    keywords: this.extractKeywords(article.title + ' ' + article.text)
                };
            });
        });
        
        console.log(`ğŸ“š Index built with ${Object.keys(index).length} articles`);
        return index;
    }

    extractKeywords(text) {
        return text.toLowerCase()
            .replace(/[Î¬Î¬á¼€á¼á¼‚á¼ƒá¼„á¼…á¼†á¼‡á½°Î¬á¾€á¾á¾‚á¾ƒá¾„á¾…á¾†á¾‡á¾°á¾±á¾²á¾³á¾´á¾¶á¾·]/g, 'Î±')
            .replace(/[Î­Î­á¼á¼‘á¼’á¼“á¼”á¼•á½²Î­]/g, 'Îµ')
            .replace(/[Î®Î®á¼ á¼¡á¼¢á¼£á¼¤á¼¥á¼¦á¼§á½´Î®á¿‚á¿ƒá¿„á¿†á¿‡]/g, 'Î·')
            .replace(/[Î¯Î¯á¼°á¼±á¼²á¼³á¼´á¼µá¼¶á¼·á½¶Î¯á¿’á¿–á¿—]/g, 'Î¹')
            .replace(/[ÏŒÏŒá½€á½á½‚á½ƒá½„á½…á½¸ÏŒ]/g, 'Î¿')
            .replace(/[ÏÏá½á½‘á½’á½“á½”á½•á½–á½—á½ºÏá¿¢á¿¦á¿§]/g, 'Ï…')
            .replace(/[ÏÏá½ á½¡á½¢á½£á½¤á½¥á½¦á½§á½¼Ïá¿²á¿³á¿´á¿¶á¿·]/g, 'Ï‰')
            .split(/\s+/)
            .filter(word => word.length > 2);
    }

    search(query) {
        console.log(`ğŸ” Searching for: "${query}"`);
        
        if (!query || query.trim() === '') {
            return [];
        }

        // Simple article number search
        const articleMatch = query.match(/^(\d+)([Î±Î²Î³Î´Î‘Î’Î“Î”]?)$/i);
        if (articleMatch) {
            const articleNum = articleMatch[1] + (articleMatch[2] || '');
            return this.searchByArticle(articleNum);
        }

        // Text search
        return this.searchByText(query);
    }

    searchByArticle(articleNumber) {
        const results = [];
        
        Object.keys(sampleData).forEach(codeType => {
            if (sampleData[codeType][articleNumber]) {
                const article = sampleData[codeType][articleNumber];
                results.push({
                    article: articleNumber,
                    code: codeType,
                    title: article.title,
                    text: article.text,
                    relevance: 1.0
                });
            }
        });
        
        console.log(`ğŸ“„ Found ${results.length} articles for number ${articleNumber}`);
        return results.sort((a, b) => b.relevance - a.relevance);
    }

    searchByText(query) {
        const results = [];
        const searchTerms = this.extractKeywords(query);
        
        Object.values(this.searchIndex).forEach(item => {
            let score = 0;
            let matches = 0;
            
            searchTerms.forEach(term => {
                if (item.title.toLowerCase().includes(term)) {
                    score += 3; // Title matches are more important
                    matches++;
                }
                if (item.keywords.includes(term)) {
                    score += 1;
                    matches++;
                }
            });
            
            if (matches > 0) {
                const relevance = score / searchTerms.length;
                results.push({
                    article: item.article,
                    code: item.code,
                    title: item.title,
                    text: item.text,
                    relevance: relevance,
                    matchedTerms: matches
                });
            }
        });
        
        const sortedResults = results.sort((a, b) => b.relevance - a.relevance).slice(0, 10);
        console.log(`ğŸ“Š Found ${sortedResults.length} text search results`);
        return sortedResults;
    }
}

// Basic App Class
class CodexApp {
    constructor() {
        this.search = new CodexSearch();
        this.currentSection = 'home';
        this.currentView = null;
        console.log("ğŸš€ App initialized");
        this.initializeEventListeners();
    }

    initializeEventListeners() {
        console.log("ğŸ§ Setting up event listeners...");
        
        // Search functionality
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        
        if (searchInput) {
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    this.performSearch();
                }
            });
        }
        
        if (searchBtn) {
            searchBtn.addEventListener('click', () => this.performSearch());
        }

        // Search mode buttons
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                this.search.currentMode = e.target.dataset.mode;
                console.log(`ğŸ”„ Search mode changed to: ${this.search.currentMode}`);
            });
        });

        // Browse buttons
        document.querySelectorAll('[data-action="browse"]').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                const code = e.target.closest('[data-code]').dataset.code;
                this.showBrowse(code);
            });
        });

        // Bookmark and recent items
        document.querySelectorAll('.bookmark-item, .recent-item').forEach(item => {
            item.addEventListener('click', () => {
                const article = item.dataset.article;
                const code = item.dataset.code;
                this.showArticle(article, code);
            });
        });

        console.log("âœ… Event listeners set up successfully");
    }

    performSearch() {
        const query = document.getElementById('searchInput').value.trim();
        
        if (!query) {
            console.log("âš ï¸ Empty search query");
            return;
        }
        
        console.log(`ğŸ” Performing search: "${query}"`);
        const results = this.search.search(query);
        this.displaySearchResults(results, query);
        this.showSection('search');
    }

    displaySearchResults(results, query) {
        const container = document.getElementById('searchResults');
        
        if (!container) {
            console.error("âŒ Search results container not found");
            return;
        }
        
        if (results.length === 0) {
            container.innerHTML = `
                <div class="no-results">
                    <h3>Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ Î±Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î± Î³Î¹Î± "${query}"</h3>
                    <p>Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ¿ÏÏ‚ ÏŒÏÎ¿Ï…Ï‚ Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚.</p>
                </div>
            `;
            return;
        }
        
        let html = `<h3>Î‘Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î± Î³Î¹Î± "${query}" (${results.length})</h3>`;
        
        results.forEach(result => {
            const codeClass = result.code === 'PK' ? 'pk' : 'kpd';
            const codeName = result.code === 'PK' ? 'Î Îš' : 'ÎšÎ Î”';
            
            html += `
                <div class="result-item" onclick="app.showArticle('${result.article}', '${result.code}')">
                    <div class="result-header">
                        <div class="result-article">Î†ÏÎ¸ÏÎ¿ ${result.article}</div>
                        <div class="result-code ${codeClass}">${codeName}</div>
                    </div>
                    <div class="result-title">${result.title}</div>
                    <div class="result-snippet">${this.createSnippet(result.text, 150)}</div>
                </div>
            `;
        });
        
        container.innerHTML = html;
        console.log(`âœ… Displayed ${results.length} search results`);
    }

    createSnippet(text, maxLength) {
        if (text.length <= maxLength) return text;
        const truncated = text.substring(0, maxLength);
        const lastSpace = truncated.lastIndexOf(' ');
        return lastSpace > 0 ? truncated.substring(0, lastSpace) + '...' : truncated + '...';
    }

    showArticle(articleNum, codeType) {
        console.log(`ğŸ“„ Showing article ${articleNum} from ${codeType}`);
        
        const article = sampleData[codeType][articleNum];
        if (!article) {
            console.error(`âŒ Article ${articleNum} not found in ${codeType}`);
            return;
        }
        
        const codeName = codeType === 'PK' ? 'Î Îš' : 'ÎšÎ Î”';
        const codeIcon = codeType === 'PK' ? 'ğŸ“•' : 'ğŸ“˜';
        const codeClass = codeType === 'PK' ? 'pk' : 'kpd';
        
        let html = `
            <div class="article-header">
                <h2>Î†ÏÎ¸ÏÎ¿ ${articleNum} - ${article.title}</h2>
                <div class="meta">
                    <span class="code-icon ${codeClass}">${codeIcon}</span>
                    ${codeName} | Î•Î½Î·Î¼ÎµÏÏ‰Î¼Î­Î½Î· Î­ÎºÎ´Î¿ÏƒÎ·
                </div>
            </div>
            
            <div class="article-content">
        `;
        
        if (article.paragraphs && article.paragraphs.length > 1) {
            article.paragraphs.forEach((para, index) => {
                html += `
                    <div class="paragraph">
                        <span class="paragraph-number">${index + 1}.</span>
                        ${para}
                    </div>
                `;
            });
        } else {
            html += `<p>${article.text}</p>`;
        }
        
        html += `
            </div>
            
            <div class="article-actions">
                <button class="action-btn" onclick="app.copyArticle('${articleNum}', '${codeType}')">
                    ğŸ“‹ Î‘Î½Ï„Î¹Î³ÏÎ±Ï†Î®
                </button>
                <button class="action-btn" onclick="app.shareArticle('${articleNum}', '${codeType}')">
                    ğŸ“¤ ÎšÎ¿Î¹Î½Î¿Ï€Î¿Î¯Î·ÏƒÎ·
                </button>
            </div>
        `;
        
        const articleView = document.getElementById('articleView');
        if (articleView) {
            articleView.innerHTML = html;
            this.showSection('article');
            console.log(`âœ… Article ${articleNum} displayed`);
        } else {
            console.error("âŒ Article view container not found");
        }
    }

    showBrowse(codeType) {
        console.log(`ğŸ“š Showing browse for ${codeType}`);
        
        const codeName = codeType === 'PK' ? 'Î Î¿Î¹Î½Î¹ÎºÏŒÏ‚ ÎšÏÎ´Î¹ÎºÎ±Ï‚' : 'ÎšÏÎ´Î¹ÎºÎ±Ï‚ Î Î¿Î¹Î½Î¹ÎºÎ®Ï‚ Î”Î¹ÎºÎ¿Î½Î¿Î¼Î¯Î±Ï‚';
        const articles = Object.keys(sampleData[codeType]);
        
        let html = `
            <div class="browse-header">
                <h2>${codeName}</h2>
            </div>
            <div class="article-list">
        `;
        
        articles.forEach(articleNum => {
            const article = sampleData[codeType][articleNum];
            
            html += `
                <div class="article-list-item" onclick="app.showArticle('${articleNum}', '${codeType}')">
                    <div class="article-list-info">
                        <div class="article-list-number">Î†ÏÎ¸ÏÎ¿ ${articleNum}</div>
                        <div class="article-list-title">${article.title}</div>
                    </div>
                </div>
            `;
        });
        
        html += '</div>';
        
        const browseView = document.getElementById('browseView');
        if (browseView) {
            browseView.innerHTML = html;
            this.showSection('browse');
            console.log(`âœ… Browse view for ${codeType} displayed`);
        } else {
            console.error("âŒ Browse view container not found");
        }
    }

    showSection(sectionName) {
        console.log(`ğŸ”„ Switching to section: ${sectionName}`);
        
        document.querySelectorAll('.section').forEach(section => {
            section.classList.remove('active');
        });
        
        const targetSection = document.getElementById(sectionName + 'Section');
        if (targetSection) {
            targetSection.classList.add('active');
            this.currentSection = sectionName;
            console.log(`âœ… Section ${sectionName} activated`);
        } else {
            console.error(`âŒ Section ${sectionName} not found`);
        }
    }

    copyArticle(articleNum, codeType) {
        const article = sampleData[codeType][articleNum];
        const codeName = codeType === 'PK' ? 'Î Îš' : 'ÎšÎ Î”';
        const text = `Î†ÏÎ¸ÏÎ¿ ${articleNum} ${codeName} - ${article.title}\n\n${article.text}`;
        
        navigator.clipboard.writeText(text).then(() => {
            this.showToast('Î¤Î¿ Î¬ÏÎ¸ÏÎ¿ Î±Î½Ï„Î¹Î³ÏÎ¬Ï†Î·ÎºÎµ ÏƒÏ„Î¿ Ï€ÏÏŒÏ‡ÎµÎ¹ÏÎ¿');
            console.log(`ğŸ“‹ Article ${articleNum} copied to clipboard`);
        }).catch(err => {
            console.error('âŒ Copy failed:', err);
        });
    }

    shareArticle(articleNum, codeType) {
        const article = sampleData[codeType][articleNum];
        const codeName = codeType === 'PK' ? 'Î Îš' : 'ÎšÎ Î”';
        const text = `Î†ÏÎ¸ÏÎ¿ ${articleNum} ${codeName} - ${article.title}\n\n${article.text}`;
        
        if (navigator.share) {
            navigator.share({
                title: `Î†ÏÎ¸ÏÎ¿ ${articleNum} ${codeName} - ${article.title}`,
                text: text
            }).then(() => {
                console.log(`ğŸ“¤ Article ${articleNum} shared`);
            }).catch(err => {
                console.error('âŒ Share failed:', err);
            });
        } else {
            this.copyArticle(articleNum, codeType);
            this.showToast('Î¤Î¿ Î¬ÏÎ¸ÏÎ¿ Î±Î½Ï„Î¹Î³ÏÎ¬Ï†Î·ÎºÎµ Î³Î¹Î± ÎºÎ¿Î¹Î½Î¿Ï€Î¿Î¯Î·ÏƒÎ·');
        }
    }

    showToast(message) {
        console.log(`ğŸ Toast: ${message}`);
        
        // Create toast notification
        const toast = document.createElement('div');
        toast.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2c3e50;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            z-index: 1000;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        `;
        toast.textContent = message;
        
        document.body.appendChild(toast);
        
        setTimeout(() => {
            document.body.removeChild(toast);
        }, 3000);
    }
}

// Initialize the application
let app;
document.addEventListener('DOMContentLoaded', () => {
    console.log("ğŸ DOM Content Loaded - Initializing Codex Criminalis...");
    try {
        app = new CodexApp();
        console.log("âœ… Codex Criminalis initialized successfully!");
    } catch (error) {
        console.error("âŒ Failed to initialize Codex Criminalis:", error);
    }
});

console.log("ğŸ“œ Codex Criminalis script loaded successfully");
